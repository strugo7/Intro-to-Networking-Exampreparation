<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מבוא לתקשורת - שיעור 4: שכבת הרשת</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap');

        body {
            font-family: 'Heebo', sans-serif;
            background-color: #020617;
            color: #e2e8f0;
        }

        .font-mono {
            font-family: 'Fira Code', monospace;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .neon-text {
            text-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }

        .routing-table-row {
            transition: all 0.2s;
            border-bottom: 1px solid #1e293b;
        }

        .routing-table-row:hover {
            background: #1e293b;
        }

        /* Custom Animations */
        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .router-active {
            animation: bounce 1s infinite;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );

        const RouterIcon = (props) => <IconBase {...props}><rect width="20" height="8" x="2" y="13" rx="2" /><path d="M2 13h20" /><path d="M6 13v3" /><path d="M18 13v3" /><path d="M12 2v3" /><path d="M12 8v5" /><path d="M9 5l3-3 3 3" /></IconBase>;
        const MapIcon = (props) => <IconBase {...props}><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21" /><line x1="9" x2="9" y1="3" y2="18" /><line x1="15" x2="15" y1="6" y2="21" /></IconBase>;
        const ScissorsIcon = (props) => <IconBase {...props}><circle cx="6" cy="6" r="3" /><circle cx="6" cy="18" r="3" /><line x1="20" x2="8.12" y1="4" y2="15.88" /><line x1="14.47" x2="20" y1="14.48" y2="20" /><line x1="8.12" x2="12" y1="8.12" y2="12" /></IconBase>;
        const GlobeIcon = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><line x1="2" x2="22" y1="12" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" /></IconBase>;
        const HomeIcon = (props) => <IconBase {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></IconBase>;
        const SearchIcon = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8" /><line x1="21" x2="16.65" y1="21" y2="16.65" /></IconBase>;
        const AlertIcon = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></IconBase>;
        const ArrowRight = (props) => <IconBase {...props}><line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /></IconBase>;
        const LayersIcon = (props) => <IconBase {...props}><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 17 12 22 22 17" /><polyline points="2 12 12 17 22 12" /></IconBase>;

        // --- COMPONENTS ---

        const SectionHeader = ({ title, subtitle, icon: Icon, color = "emerald" }) => (
            <div className={`mb-12 border-r-4 border-${color}-500 pr-6`}>
                <div className="flex items-center gap-4 mb-2">
                    <div className={`p-3 bg-${color}-500/10 rounded-xl text-${color}-400 shadow-lg shadow-${color}-900/20`}>
                        <Icon size={32} />
                    </div>
                    <h2 className="text-4xl md:text-5xl font-black text-white tracking-tight">{title}</h2>
                </div>
                <p className="text-slate-400 text-xl font-light max-w-2xl">{subtitle}</p>
            </div>
        );

        // --- INTERACTIVE VISUALIZERS ---

        // 1. Packet Journey Demo (End-to-End) with 3 Routers
        const PacketJourneyDemo = () => {
            const [step, setStep] = useState(0);
            // Steps:
            // 0: Idle
            // 1: Host -> R1
            // 2: Processing R1
            // 3: R1 -> R2
            // 4: Processing R2
            // 5: R2 -> R3
            // 6: Processing R3
            // 7: R3 -> Host B
            // 8: Arrived

            const nodes = [
                { id: 'hostA', name: 'Host A', ip: '192.168.1.10', mac: 'AA:AA' },
                { id: 'r1', name: 'R1', ip: '192.168.1.1', macIn: 'R1:11', macOut: 'R1:22' },
                { id: 'r2', name: 'R2', ip: '10.0.0.1', macIn: 'R2:11', macOut: 'R2:22' },
                { id: 'r3', name: 'R3', ip: '172.16.0.1', macIn: 'R3:11', macOut: 'R3:22' },
                { id: 'hostB', name: 'Host B', ip: '172.16.0.50', mac: 'BB:BB' }
            ];

            const explanations = [
                "מוכן ליציאה. לחץ על 'התחל מסע' כדי לשלוח את החבילה.",
                "החבילה יוצאת מ-Host A (צד ימין). כתובת היעד (IP) היא של Host B, אבל כתובת ה-MAC היא של הראוטר הראשון.",
                "החבילה הגיעה ל-R1. הראוטר מסיר את המעטפה הישנה (Layer 2 Frame) ובודק בטבלת הניתוב לאן להעביר את ה-IP.",
                "R1 מצא מסלול! הוא אורז את החבילה במעטפה חדשה. המקור: R1, היעד: R2.",
                "החבילה הגיעה ל-R2. שוב, הסרת המעטפה, בדיקת IP, והחלטה לאן להעביר.",
                "R2 מעביר ל-R3. שים לב: ה-IP לא השתנה לרגע! רק ה-MAC משתנה בכל קפיצה (Hop).",
                "החבילה אצל R3. הוא מזהה שהיעד (Host B) נמצא ברשת המקומית שלו.",
                "R3 שולח את החבילה ישירות ל-Host B (צד שמאל). המעטפה האחרונה נכתבת עם ה-MAC של Host B.",
                "החבילה הגיעה ליעד בהצלחה! Host B פותח את המעטפה וקורא את המידע."
            ];

            const getCurrentMacs = () => {
                switch (step) {
                    case 1: return { src: nodes[0].mac, dst: nodes[1].macIn };
                    case 3: return { src: nodes[1].macOut, dst: nodes[2].macIn };
                    case 5: return { src: nodes[2].macOut, dst: nodes[3].macIn };
                    case 7: return { src: nodes[3].macOut, dst: nodes[4].mac };
                    default: return { src: '...', dst: '...' };
                }
            };

            const getPacketPosition = () => {
                // Right to Left movement (RTL: 95% is right, 5% is left)
                switch (step) {
                    case 0: return '95%'; // Start at Host A
                    case 1: return '80%'; // Moving to R1
                    case 2: return '75%'; // At R1
                    case 3: return '55%'; // Moving to R2
                    case 4: return '50%'; // At R2
                    case 5: return '30%'; // Moving to R3
                    case 6: return '25%'; // At R3
                    case 7: return '5%';  // Moving to Host B
                    case 8: return '5%';  // At Host B
                    default: return '95%';
                }
            };

            const nextStep = () => {
                if (step < 8) setStep(step + 1);
                else setStep(0);
            };

            const macs = getCurrentMacs();

            return (
                <div className="glass-panel p-6 md:p-8 rounded-2xl relative overflow-hidden">
                    <h3 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                        <LayersIcon className="text-pink-400" />
                        המסע מקצה לקצה (End-to-End)
                    </h3>

                    {/* Explanation Box */}
                    <div className="mb-8 bg-slate-900 border-r-4 border-emerald-500 p-4 rounded shadow-lg min-h-[80px] flex items-center">
                        <p className="text-lg text-emerald-100">
                            <span className="font-bold text-emerald-400 ml-2">שלב {step}:</span>
                            {explanations[step]}
                        </p>
                    </div>

                    {/* Diagram */}
                    <div className="relative h-48 bg-slate-800/30 rounded-xl border border-slate-700 flex justify-between items-center px-4 md:px-12 mb-6">
                        {/* Connecting Line */}
                        <div className="absolute top-1/2 left-10 right-10 h-1 bg-slate-700 -z-1"></div>

                        {/* Nodes */}
                        {nodes.map((node, i) => (
                            <div key={node.id} className="relative z-10 flex flex-col items-center bg-slate-900 p-2 rounded-lg border border-slate-600 shadow-xl" style={{ width: '80px' }}>
                                {i === 0 || i === 4 ? <HomeIcon className={i === 0 ? 'text-blue-400' : 'text-purple-400'} /> : <RouterIcon className="text-orange-400" />}
                                <div className="text-xs font-bold text-white mt-1">{node.name}</div>
                                <div className="text-[9px] text-slate-500 font-mono">{node.ip}</div>
                            </div>
                        ))}

                        {/* Packet */}
                        {step > 0 && (
                            <div
                                className="absolute top-1/2 -translate-y-1/2 transition-all duration-1000 ease-in-out z-20 flex flex-col items-center"
                                style={{
                                    left: getPacketPosition(),
                                    transform: 'translate(-50%, -50%)',
                                    opacity: (step % 2 === 0 && step !== 8) ? 0.5 : 1 // Dim when processing inside router
                                }}
                            >
                                <div className={`
                                    bg-slate-900 border-2 rounded p-2 shadow-2xl w-40 text-[10px] font-mono
                                    ${step % 2 === 0 ? 'border-orange-500 scale-90' : 'border-blue-500 scale-110'}
                                    transition-all
                                `}>
                                    {/* L2 Header */}
                                    <div className="flex justify-between border-b border-slate-700 pb-1 mb-1 text-pink-400 font-bold">
                                        <span>L2 FRAME (MAC)</span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-1 mb-2 text-slate-300">
                                        <div>Src: {macs.src}</div>
                                        <div className="text-right">Dst: {macs.dst}</div>
                                    </div>

                                    {/* L3 Header */}
                                    <div className="bg-emerald-900/30 border border-emerald-500/30 p-1 rounded">
                                        <div className="text-emerald-400 text-center mb-1 font-bold">L3 IP (Fixed)</div>
                                        <div className="flex justify-between text-white">
                                            <span>{nodes[0].ip}</span> &rarr;
                                            <span>{nodes[4].ip}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Status Badge */}
                                <div className="mt-2 bg-black/60 text-white text-[10px] px-2 py-1 rounded backdrop-blur-sm">
                                    {step % 2 === 0 && step !== 8 ? "Routing Decision..." : "Traveling..."}
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="flex justify-center">
                        <button
                            onClick={nextStep}
                            className={`
                                px-8 py-3 rounded-full font-bold shadow-lg transition-all flex items-center gap-2
                                ${step === 8 ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-emerald-600 hover:bg-emerald-500 text-white shadow-emerald-900/20'}
                            `}
                        >
                            {step === 0 ? "התחל מסע (Start)" : (step === 8 ? "אתחל מחדש (Reset)" : "הצעד הבא (Next) ->")}
                        </button>
                    </div>
                </div>
            );
        };

        // 2. IP Header X-Ray
        const IPHeaderVisualizer = () => {
            const [hoverField, setHoverField] = useState(null);

            const fields = [
                { id: 'ver', label: 'Version', bits: 4, desc: 'IPv4 או IPv6. בדרך כלל הערך הוא 4.' },
                { id: 'ihl', label: 'IHL', bits: 4, desc: 'אורך הכותרת (בדרך כלל 20 בייטים).' },
                { id: 'tos', label: 'Type of Service', bits: 8, desc: 'תיעדוף (QoS). כאן קובעים אם זו שיחת זום שצריכה עדיפות על פני מייל.' },
                { id: 'len', label: 'Total Length', bits: 16, desc: 'הגודל הכולל של החבילה (Header + Data).' },
                { id: 'id', label: 'Identification', bits: 16, desc: 'זיהוי ייחודי לפרגמנטציה. משייך חתיכות לאותה חבילה מקורית.' },
                { id: 'flg', label: 'Flags', bits: 3, desc: 'הוראות לפרגמנטציה: "Don\'t Fragment" או "More Fragments".' },
                { id: 'off', label: 'Fragment Offset', bits: 13, desc: 'איפה החתיכה הזו ממוקמת ביחס לחבילה המקורית.' },
                { id: 'ttl', label: 'TTL (Time to Live)', bits: 8, desc: 'מונה חיים. יורד ב-1 בכל ראוטר. ב-0 החבילה מתה (מונע לולאות אינסופיות).' },
                { id: 'proto', label: 'Protocol', bits: 8, desc: 'מי מחכה בפנים? 6=TCP, 17=UDP, 1=ICMP.' },
                { id: 'sum', label: 'Header Checksum', bits: 16, desc: 'בדיקת תקינות. מוודא שהכותרת לא נהרסה בדרך.' },
                { id: 'src', label: 'Source IP Address', bits: 32, desc: 'מאיפה יצאתי? (למשל 192.168.1.5)' },
                { id: 'dst', label: 'Destination IP Address', bits: 32, desc: 'לאן אני הולך? (למשל 8.8.8.8)' },
            ];

            return (
                <div className="flex flex-col lg:flex-row gap-8 items-start">
                    <div className="flex-1 w-full bg-slate-900 border border-slate-700 rounded-xl p-6 shadow-2xl relative overflow-hidden">
                        <div className="text-center text-slate-500 text-xs mb-4 font-mono">IPv4 HEADER (20 Bytes)</div>
                        <div className="grid grid-cols-32 gap-1 text-[10px] font-mono select-none">
                            {/* Row 1 */}
                            <div onMouseEnter={() => setHoverField('ver')} className="col-span-4 bg-blue-900/50 hover:bg-blue-600 text-blue-200 border border-blue-700/50 p-2 rounded flex items-center justify-center cursor-help transition-colors">VER</div>
                            <div onMouseEnter={() => setHoverField('ihl')} className="col-span-4 bg-blue-900/30 hover:bg-blue-600 text-blue-200 border border-blue-700/50 p-2 rounded flex items-center justify-center cursor-help transition-colors">IHL</div>
                            <div onMouseEnter={() => setHoverField('tos')} className="col-span-8 bg-slate-800 hover:bg-slate-600 text-slate-300 border border-slate-700 p-2 rounded flex items-center justify-center cursor-help transition-colors">TOS</div>
                            <div onMouseEnter={() => setHoverField('len')} className="col-span-16 bg-slate-800 hover:bg-slate-600 text-slate-300 border border-slate-700 p-2 rounded flex items-center justify-center cursor-help transition-colors">Total Length</div>

                            {/* Row 2 */}
                            <div onMouseEnter={() => setHoverField('id')} className="col-span-16 bg-purple-900/40 hover:bg-purple-600 text-purple-200 border border-purple-700/50 p-2 rounded flex items-center justify-center cursor-help transition-colors">Identification</div>
                            <div onMouseEnter={() => setHoverField('flg')} className="col-span-3 bg-purple-900/40 hover:bg-purple-600 text-purple-200 border border-purple-700/50 p-2 rounded flex items-center justify-center cursor-help transition-colors">Flg</div>
                            <div onMouseEnter={() => setHoverField('off')} className="col-span-13 bg-purple-900/40 hover:bg-purple-600 text-purple-200 border border-purple-700/50 p-2 rounded flex items-center justify-center cursor-help transition-colors">Fragment Offset</div>

                            {/* Row 3 */}
                            <div onMouseEnter={() => setHoverField('ttl')} className="col-span-8 bg-red-900/40 hover:bg-red-600 text-red-200 border border-red-700/50 p-2 rounded flex items-center justify-center cursor-help transition-colors font-bold">TTL</div>
                            <div onMouseEnter={() => setHoverField('proto')} className="col-span-8 bg-green-900/40 hover:bg-green-600 text-green-200 border border-green-700/50 p-2 rounded flex items-center justify-center cursor-help transition-colors">Protocol</div>
                            <div onMouseEnter={() => setHoverField('sum')} className="col-span-16 bg-slate-800 hover:bg-slate-600 text-slate-300 border border-slate-700 p-2 rounded flex items-center justify-center cursor-help transition-colors">Header Checksum</div>

                            {/* Row 4 */}
                            <div onMouseEnter={() => setHoverField('src')} className="col-span-32 bg-emerald-600 hover:bg-emerald-500 text-white border border-emerald-500 p-3 rounded flex items-center justify-center font-bold cursor-help transition-colors shadow-lg">Source IP Address</div>

                            {/* Row 5 */}
                            <div onMouseEnter={() => setHoverField('dst')} className="col-span-32 bg-emerald-800 hover:bg-emerald-500 text-white border border-emerald-700 p-3 rounded flex items-center justify-center font-bold cursor-help transition-colors shadow-lg mt-1">Destination IP Address</div>
                        </div>
                    </div>

                    <div className="w-full lg:w-1/3 min-h-[200px]">
                        {hoverField ? (
                            <div className="glass-panel p-6 rounded-xl border-t-4 border-emerald-500 animate-fade-in">
                                <h4 className="text-2xl font-bold text-white mb-2">{fields.find(f => f.id === hoverField).label}</h4>
                                <div className="text-emerald-400 font-mono text-sm mb-4">{fields.find(f => f.id === hoverField).bits} bits</div>
                                <p className="text-slate-300 text-lg leading-relaxed">
                                    {fields.find(f => f.id === hoverField).desc}
                                </p>
                            </div>
                        ) : (
                            <div className="glass-panel p-6 rounded-xl border-dashed border-2 border-slate-700 flex flex-col items-center justify-center h-full text-slate-500 text-center">
                                <SearchIcon size={48} className="mb-4 opacity-50" />
                                <p>העבר את העכבר על שדות הכותרת<br />כדי לראות הסבר מפורט</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 3. Routing Logic Simulator
        const RouterSimulator = () => {
            const [packet, setPacket] = useState(null); // { ip, status: 'input' | 'processing' | 'routed' | 'dropped' , route: null }
            const [selectedIP, setSelectedIP] = useState('192.168.1.50');

            const routes = [
                { network: '192.168.1.0', mask: '/24', interface: 'Eth0 (LAN)', color: 'border-blue-500 bg-blue-500/10' },
                { network: '10.0.0.0', mask: '/8', interface: 'Eth1 (Corp)', color: 'border-purple-500 bg-purple-500/10' },
                { network: '0.0.0.0', mask: '/0', interface: 'Serial0 (ISP)', color: 'border-orange-500 bg-orange-500/10' } // Default Route
            ];

            const predefinedIPs = [
                '192.168.1.50', '192.168.1.200',
                '10.5.5.5', '10.200.1.1',
                '8.8.8.8', '142.250.1.1'
            ];

            const handleRoute = () => {
                setPacket({ ip: selectedIP, status: 'processing' });

                setTimeout(() => {
                    // Simple Logic for demo purposes
                    let matchedRoute = routes[2]; // Default
                    if (selectedIP.startsWith('192.168.1')) matchedRoute = routes[0];
                    else if (selectedIP.startsWith('10.')) matchedRoute = routes[1];

                    setPacket(prev => ({ ...prev, status: 'routed', route: matchedRoute }));

                    setTimeout(() => {
                        setPacket(null); // Reset
                    }, 3000);
                }, 1500);
            };

            return (
                <div className="glass-panel p-8 rounded-2xl relative overflow-hidden">
                    <div className="flex flex-col md:flex-row justify-between gap-12">

                        {/* INPUT SIDE */}
                        <div className="w-full md:w-1/3 space-y-6 z-10">
                            <div>
                                <label className="block text-slate-400 text-sm mb-2 font-bold">1. בחר כתובת IP ליעד:</label>
                                <div className="grid grid-cols-2 gap-2 mb-4">
                                    {predefinedIPs.map(ip => (
                                        <button
                                            key={ip}
                                            onClick={() => setSelectedIP(ip)}
                                            className={`px-3 py-2 rounded text-sm font-mono transition-colors ${selectedIP === ip ? 'bg-emerald-600 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}
                                        >
                                            {ip}
                                        </button>
                                    ))}
                                </div>
                                <button
                                    onClick={handleRoute}
                                    disabled={packet !== null}
                                    className="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 rounded-lg shadow-lg shadow-emerald-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                >
                                    {packet ? 'מעבד...' : 'שלח חבילה (Route Packet)'}
                                </button>
                            </div>

                            {/* ROUTING TABLE */}
                            <div className="bg-slate-900 rounded-lg border border-slate-700 overflow-hidden">
                                <div className="bg-slate-800 px-4 py-2 text-xs font-bold text-slate-400 border-b border-slate-700 flex justify-between">
                                    <span>ROUTING TABLE</span>
                                    <span>R1</span>
                                </div>
                                <div className="p-2">
                                    <div className="grid grid-cols-3 text-[10px] text-slate-500 font-mono mb-2 px-2">
                                        <span>Network</span>
                                        <span>Mask</span>
                                        <span>Interface</span>
                                    </div>
                                    {routes.map((r, i) => (
                                        <div key={i} className={`grid grid-cols-3 text-xs font-mono p-2 rounded transition-colors ${packet?.route === r ? 'bg-emerald-500/20 text-white' : 'text-slate-300'}`}>
                                            <span>{r.network}</span>
                                            <span>{r.mask}</span>
                                            <span className="text-yellow-500">{r.interface}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* VISUALIZATION SIDE */}
                        <div className="flex-1 relative bg-slate-900/50 rounded-xl border border-slate-700 min-h-[300px] flex items-center justify-center">
                            {/* Router Center */}
                            <div className="relative z-20 bg-slate-800 p-4 rounded-full border-4 border-slate-600 shadow-2xl">
                                <RouterIcon size={48} className={packet?.status === 'processing' ? 'text-emerald-400 animate-pulse' : 'text-slate-400'} />
                                <div className="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs font-bold text-slate-500">ROUTER</div>
                            </div>

                            {/* Interfaces */}
                            {/* Eth0 */}
                            <div className="absolute top-1/2 right-10 -translate-y-1/2 flex items-center gap-2">
                                <div className="text-right">
                                    <div className="text-xs text-blue-400 font-bold">LAN (Eth0)</div>
                                    <div className="text-[10px] text-slate-500">192.168.1.0/24</div>
                                </div>
                                <div className="w-24 h-1 bg-blue-900"></div>
                            </div>

                            {/* Eth1 */}
                            <div className="absolute bottom-10 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2">
                                <div className="w-1 h-24 bg-purple-900"></div>
                                <div className="text-center">
                                    <div className="text-xs text-purple-400 font-bold">Corp (Eth1)</div>
                                    <div className="text-[10px] text-slate-500">10.0.0.0/8</div>
                                </div>
                            </div>

                            {/* Serial0 */}
                            <div className="absolute top-10 left-10 flex items-center gap-2">
                                <div className="text-center">
                                    <div className="text-xs text-orange-400 font-bold">Internet (ISP)</div>
                                    <div className="text-[10px] text-slate-500">0.0.0.0/0</div>
                                </div>
                                <div className="w-32 h-1 bg-orange-900 rotate-45 origin-left transform translate-y-2"></div>
                            </div>

                            {/* Packet Animation */}
                            {packet && (
                                <div
                                    className="absolute z-30 transition-all duration-1000 ease-in-out"
                                    style={{
                                        top: packet.status === 'processing' ? '50%' : (packet.route?.interface.includes('ISP') ? '15%' : (packet.route?.interface.includes('Corp') ? '85%' : '50%')),
                                        left: packet.status === 'processing' ? '50%' : (packet.route?.interface.includes('ISP') ? '15%' : (packet.route?.interface.includes('Corp') ? '50%' : '85%')),
                                        transform: 'translate(-50%, -50%)',
                                        opacity: packet.status === 'processing' || packet.status === 'routed' ? 1 : 0
                                    }}
                                >
                                    <div className="bg-emerald-500 text-black text-[10px] font-bold px-2 py-1 rounded shadow-lg glow">
                                        PKT: {packet.ip}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // 4. Fragmentation Visualizer
        const FragmentationDemo = () => {
            const [packetSize, setPacketSize] = useState(4000);
            const mtu = 1500;
            const headerSize = 20;
            const maxPayload = mtu - headerSize; // 1480

            const fragments = [];
            let remaining = packetSize;
            let offset = 0;

            while (remaining > 0) {
                const payload = Math.min(remaining, maxPayload);
                fragments.push({
                    size: payload + headerSize,
                    payload: payload,
                    offset: offset / 8, // Offset is in 8-byte blocks
                    moreFragments: remaining > maxPayload
                });
                remaining -= payload;
                offset += payload;
            }

            return (
                <div className="glass-panel p-8 rounded-2xl">
                    <h3 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                        <ScissorsIcon className="text-yellow-400" />
                        פרגמנטציה (Fragmentation)
                    </h3>

                    <div className="mb-8">
                        <p className="text-slate-300 mb-4">
                            כאשר חבילה גדולה מדי עבור ה-MTU (Maximum Transmission Unit) של הרשת (בדרך כלל 1500 בייטים),
                            הראוטר נאלץ לחתוך אותה לחתיכות קטנות.
                        </p>
                        <div className="flex items-center gap-4 bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                            <label className="text-sm font-bold text-slate-400">גודל החבילה המקורית:</label>
                            <input
                                type="range" min="1500" max="6000" step="100"
                                value={packetSize}
                                onChange={(e) => setPacketSize(Number(e.target.value))}
                                className="w-48 accent-emerald-500"
                            />
                            <span className="font-mono text-emerald-400">{packetSize} Bytes</span>
                        </div>
                    </div>

                    <div className="relative">
                        {/* Original Packet */}
                        <div className="mb-8">
                            <div className="text-xs text-slate-500 mb-1">ORIGINAL PACKET</div>
                            <div className="h-12 bg-blue-600 rounded flex items-center justify-center text-white font-bold shadow-lg transition-all" style={{ width: '100%', maxWidth: '100%' }}>
                                IP Packet ({packetSize} bytes)
                            </div>
                        </div>

                        <div className="flex justify-center my-4">
                            <div className="bg-yellow-500/20 text-yellow-200 px-3 py-1 rounded text-xs border border-yellow-500/50">
                                Router Constraints: MTU = 1500 Bytes
                            </div>
                        </div>

                        {/* Fragments */}
                        <div className="space-y-2">
                            <div className="text-xs text-slate-500 mb-1">FRAGMENTS ON WIRE</div>
                            <div className="flex flex-wrap gap-2">
                                {fragments.map((frag, i) => (
                                    <div key={i} className="flex flex-col items-center animate-slide-up" style={{ animationDelay: `${i * 0.1}s` }}>
                                        <div className="h-16 w-32 bg-emerald-700 border border-emerald-500 rounded flex flex-col items-center justify-center shadow-lg relative overflow-hidden group">
                                            <div className="absolute top-0 w-full h-4 bg-emerald-900 text-[9px] text-center text-emerald-200">Header ({headerSize})</div>
                                            <span className="text-white font-bold text-sm mt-3">{frag.size}B</span>
                                            <div className="text-[9px] text-emerald-200 font-mono">Off: {frag.offset} | MF: {frag.moreFragments ? 1 : 0}</div>
                                        </div>
                                        <div className="h-4 w-0.5 bg-slate-600"></div>
                                        <span className="text-[10px] text-slate-500">Frag #{i + 1}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---

        const App = () => {
            return (
                <div className="min-h-screen bg-slate-950 pb-20 overflow-x-hidden">

                    {/* Hero Section */}
                    <div className="relative bg-gradient-to-b from-emerald-900/20 via-slate-950 to-slate-950 pt-24 pb-20 px-6 border-b border-white/5">
                        <div className="max-w-6xl mx-auto text-center relative z-10">
                            <div className="inline-block mb-4">
                                <span className="py-1 px-3 rounded-full bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 text-xs font-bold tracking-wider uppercase">
                                    שכבה 3 // מודל ה-OSI
                                </span>
                            </div>
                            <h1 className="text-5xl md:text-7xl font-black text-white mb-6 neon-text tracking-tight">
                                שכבת הרשת (Network)
                            </h1>
                            <p className="text-xl md:text-2xl text-slate-300 max-w-3xl mx-auto leading-relaxed font-light">
                                "שירות הדואר" של האינטרנט. השכבה שאחראית לקחת את המידע שלך, לשים עליו כתובת (IP), ולמצוא לו את המסלול הטוב ביותר (Routing) עד ליעד, לא משנה איפה הוא בעולם.
                            </p>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-6 py-16 space-y-32">

                        {/* 1. Introduction - Analogy */}
                        <section>
                            <SectionHeader
                                title="התפקיד: ניתוב וכתובות"
                                subtitle="אם שכבה 2 היא המשאית, שכבה 3 היא ה-GPS ומערכת הכתובות."
                                icon={MapIcon}
                                color="emerald"
                            />
                            <div className="grid md:grid-cols-2 gap-12 items-center">
                                <div className="space-y-6 text-lg text-slate-300">
                                    <p>
                                        בשכבה 2 (Data Link) דיברנו על תקשורת בתוך הרשת המקומית (LAN) באמצעות MAC. אבל מה קורה כשאנחנו רוצים לשלוח הודעה לצד השני של העולם?
                                    </p>
                                    <p>
                                        כאן נכנסת **שכבת הרשת**. היא מספקת שני דברים קריטיים:
                                    </p>
                                    <ul className="space-y-4">
                                        <li className="flex items-start gap-3 bg-slate-900/50 p-4 rounded-lg border-r-4 border-emerald-500">
                                            <GlobeIcon className="text-emerald-400 shrink-0 mt-1" />
                                            <div>
                                                <strong className="text-white block">כתובות לוגיות (IP)</strong>
                                                מערכת כתובות היררכית (כמו מדינה -> עיר -> רחוב) שמאפשרת לנו למצוא כל מחשב בעולם.
                                            </div>
                                        </li>
                                        <li className="flex items-start gap-3 bg-slate-900/50 p-4 rounded-lg border-r-4 border-blue-500">
                                            <RouterIcon className="text-blue-400 shrink-0 mt-1" />
                                            <div>
                                                <strong className="text-white block">ניתוב (Routing)</strong>
                                                תהליך קבלת ההחלטות: "לאיזה כיוון אני צריך לשלוח את החבילה כדי שתגיע ליעד?". זה התפקיד של הראוטר.
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div className="relative h-64 bg-slate-900 rounded-2xl border border-slate-800 flex items-center justify-center overflow-hidden group">
                                    <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10"></div>
                                    {/* Visual Representation of WAN */}
                                    <div className="text-center relative z-10">
                                        <div className="flex gap-8 justify-center mb-4 text-slate-600">
                                            <HomeIcon size={40} />
                                            <span className="text-emerald-500 animate-pulse">.........</span>
                                            <RouterIcon size={40} className="text-white" />
                                            <span className="text-emerald-500 animate-pulse">.........</span>
                                            <GlobeIcon size={40} />
                                        </div>
                                        <p className="text-sm text-slate-400">From LAN to WAN</p>
                                    </div>
                                </div>
                            </div>
                        </section>

                        {/* NEW: End-to-End Packet Journey */}
                        <section>
                            <PacketJourneyDemo />
                        </section>

                        {/* 2. The IP Header */}
                        <section>
                            <SectionHeader
                                title="מבנה החבילה (IP Packet)"
                                subtitle="בואו נציץ פנימה. ה-Header של IP הוא כמו המעטפה של המכתב. הוא מכיל את כל מה שהראוטרים בדרך צריכים לדעת."
                                icon={SearchIcon}
                                color="blue"
                            />
                            <IPHeaderVisualizer />
                        </section>

                        {/* 3. The Router Simulator */}
                        <section>
                            <SectionHeader
                                title="המוח של הרשת: הראוטר"
                                subtitle="ראוטרים הם צומת ההחלטה. הם מחזיקים 'מפה' של הרשת (Routing Table) ומחליטים לאן כל חבילה תלך."
                                icon={RouterIcon}
                                color="purple"
                            />
                            <RouterSimulator />
                            <div className="mt-6 bg-yellow-900/20 border border-yellow-700/50 p-4 rounded-lg flex gap-3 items-start">
                                <AlertIcon className="text-yellow-500 shrink-0 mt-1" />
                                <div>
                                    <h4 className="text-yellow-400 font-bold text-sm">טיפ למבחן: Default Gateway</h4>
                                    <p className="text-yellow-200/80 text-sm">
                                        שימו לב לשורה האחרונה בטבלה (0.0.0.0/0). זהו ה-Default Gateway (שער ברירת המחדל).
                                        אם הראוטר לא מוצא התאמה ספציפית לכתובת היעד, הוא זורק את החבילה לשם (בדרך כלל לכיוון האינטרנט/ISP).
                                    </p>
                                </div>
                            </div>
                        </section>

                        {/* 4. Fragmentation */}
                        <section>
                            <SectionHeader
                                title="פרגמנטציה (Fragmentation)"
                                subtitle="לפעמים החבילה גדולה מדי בשביל הכבל. מה עושים? חותכים."
                                icon={ScissorsIcon}
                                color="orange"
                            />
                            <FragmentationDemo />
                        </section>

                        {/* Navigation Footer */}
                        <div className="mt-20 border-t border-slate-800 pt-10 flex justify-between items-center">
                            <a href="#" className="text-slate-500 hover:text-white transition-colors flex items-center gap-2">
                                <ArrowRight className="rotate-180" /> שיעור קודם: שכבת התעבורה
                            </a>
                            <div className="text-center">
                                <div className="text-xs text-slate-500 uppercase tracking-widest mb-1">You Mastered Layer 3!</div>
                                <div className="h-1 w-32 bg-slate-800 rounded-full mx-auto overflow-hidden">
                                    <div className="h-full w-full bg-emerald-500"></div>
                                </div>
                            </div>
                            <a href="#" className="bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-3 rounded-full font-bold transition-all shadow-lg shadow-emerald-900/20 flex items-center gap-2">
                                לשיעור הבא: שכבת הערוץ (Layer 2) <ArrowRight />
                            </a>
                        </div>

                    </div>

                    <footer className="text-center text-slate-600 py-12 mt-12 text-sm border-t border-slate-900/50 bg-slate-950">
                        <p>© 2026 Intro to Networking | The Complete Interactive Course</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>